```{r}
#| include: false
#| label: module-4-first-chunk
```

## `glimpse()` {.smaller}

```{r}
library(dplyr)
library(palmerpenguins)
```

```{r}
penguins |> glimpse()
```

::: {.notes}
:::

## `head()` & `tail()` {.smaller}

```{r}
library(dplyr)
library(palmerpenguins)
```

```{r}
penguins |> head(3)
```

```{r}
penguins |> tail(3)
```

```{r}
penguins |>
  pull(bill_length_mm) |>
  head(3)
```

::: {.notes}
:::

## `slice_sample()` {.smaller}

```{r}
library(dplyr)
library(palmerpenguins)
```

```{r}
penguins |> slice_sample(n = 15)
```

::: {.notes}
:::

## `unique` {.smaller}

```{r}
library(dplyr)
library(palmerpenguins)
```

```{r}
penguins |>
  pull(species) |>
  unique()
```

```{r}
penguins |>
  pull(island) |>
  unique()
```

```{r}
penguins |>
  pull(sex) |>
  unique()
```

::: {.notes}
:::

## `count()` {.smaller}

```{r}
library(dplyr)
library(palmerpenguins)
```

```{r}
penguins |>
  count(species, island, .drop = FALSE)
```

## `count()` {.smaller}

```{r}
library(dplyr)
library(magrittr)
library(palmerpenguins)
```

```{r}
penguins |>
  count(species, island, .drop = FALSE) |>
  mutate(
    n_cum = cumsum(n),
    n_per = n |>
      divide_by(sum(n)) |>
      multiply_by(100) |>
      round(3),
    n_per_cum = n_per |> cumsum()
  )
```

::: {.notes}
:::

## Statistics {.smaller}

The R packages that come with a typical R installation provide a set of basic statistical functions.

```{r}
library(dplyr)
library(palmerpenguins)
```

```{r}
bill_length_mm <- penguins |> pull(bill_length_mm)
```

::: {style="padding-top: 15px;"}
```{r}
bill_length_mm |> mean(na.rm = TRUE)
```

```{r}
bill_length_mm |> var(na.rm = TRUE)
```

```{r}
bill_length_mm |> sd(na.rm = TRUE)
```

```{r}
bill_length_mm |> min(na.rm = TRUE)
```

```{r}
bill_length_mm |> max(na.rm = TRUE)
```
:::

```{r}
bill_length_mm |> range(na.rm = TRUE)
```

::: {.notes}
:::

## Statistics {.smaller}

```{r}
library(dplyr)
library(palmerpenguins)
```

```{r}
bill_length_mm <- penguins |> pull(bill_length_mm)
```

::: {style="padding-top: 15px;"}
```{r}
bill_length_mm |> quantile(na.rm = TRUE)
```

```{r}
bill_length_mm |> quantile(prob = 0.25, na.rm = TRUE)
```

```{r}
bill_length_mm |> median(na.rm = TRUE)
```

```{r}
bill_length_mm |> quantile(prob = 0.75, na.rm = TRUE)
```

```{r}
bill_length_mm |> IQR(na.rm = TRUE)
```
:::

::: {.notes}
:::

## Statistics {.smaller}

For skewness and kurtosis, use the [`moments`](https://CRAN.R-project.org/package=moments) package.

```{r}
library(dplyr)
library(moments)
library(palmerpenguins)
```

```{r}
bill_length_mm <- penguins |> pull(bill_length_mm)
bill_depth_mm <- penguins |> pull(bill_depth_mm)
```

::: {style="padding-top: 15px;"}
```{r}
bill_length_mm |> skewness(na.rm = TRUE)
```

```{r}
bill_length_mm |> kurtosis(na.rm = TRUE)
```

```{r}
bill_length_mm |> sum(na.rm = TRUE)
```

```{r}
bill_length_mm |> prod(na.rm = TRUE)
```

```{r}
cor(bill_length_mm, bill_depth_mm, use = "complete.obs")
```
:::

## `summarize()` {.smaller}

```{r}
library(dplyr)
library(palmerpenguins)
```

```{r}
penguins |>
  summarize(
    n = n(),
    mean_body_mass_g = mean(body_mass_g, na.rm = TRUE),
    mean_bill_length_mm = mean(bill_length_mm, na.rm = TRUE),
    mean_bill_depth_mm = mean(bill_depth_mm, na.rm = TRUE),
    mean_flipper_length_mm = mean(flipper_length_mm, na.rm = TRUE),
    .by = c("species", "sex")
  )
```

::: {.notes}
:::

## Exercise (`summarize`) {.smaller}

Create a comprehensive species profile for the Palmer Penguins dataset. For each penguin species, calculate:

:::: {.columns}
::: {.column style="width: 47.5%; padding-top: 0px;"}
- Number of individuals observed.
- Number of islands they inhabit.
- Mean body mass (in grams).
- Mean bill length (in mm).
- Mean flipper length (in mm).
:::
::: {.column style="width: 5%;"}
:::
::: {.column style="width: 47.5%;"}
All of this information should be generated in a **single**, elegant operation.

```{r}
#| eval: false

penguins |>
  summarize(
    #> [Your code goes here!]
  )
```
:::
::::

## Exercise (`summarize`) {.smaller}

Use [`n()`](https://dplyr.tidyverse.org/reference/context.html) to count the number of observations.

```{r}
library(dplyr)
```

```{r}
letters
```

```{r}
tibble(a = letters) |>
  summarize(n = n())
```

::: {style="padding-top: 15px;"}
Use [`n_distinct()`](https://dplyr.tidyverse.org/reference/n_distinct.html) to count the number of unique values.

```{r}
library(dplyr)
```

```{r}
c("a", "b", "b", "a") |> n_distinct()
```
:::

::: {.notes}
:::

## Exercise (`summarize`) {.smaller}

**Solution**:

```{r}
#| code-fold: true

penguins |>
  summarize(
    n = n(),
    n_islands = n_distinct(island),
    mean_body_mass_g = mean(body_mass_g, na.rm = TRUE),
    mean_bill_length_mm = mean(bill_length_mm, na.rm = TRUE),
    mean_flipper_length_mm = mean(flipper_length_mm, na.rm = TRUE),
    .by = "species"
  )
```

## The `summarytools` Package {.smaller}

:::: {.columns}
::: {.column style="width: 15%;"}
[![](images/summarytools-hex-logo.png){style="width: 120px; padding-top: 0px;"}](https://cran.r-project.org/web/packages/summarytools/vignettes/introduction.html)
:::
::: {.column style="width: 85%; padding-top: 15px;"}
The [`summarytools`](https://cran.r-project.org/web/packages/summarytools/vignettes/introduction.html) package makes it easy to create frequency and descriptive statistics tables for single variables with minimal code.

```r
install.packages("gtsummary")
```
:::
::::

```{r}
library(palmerpenguins)
library(summarytools)
```

:::: {.columns}
::: {.column style="width: 47.5%; padding-top: 15px;"}
```{r}
#| attr-source: "style='height: 300px;'"

penguins |> freq(var = species, round.digits = 3)
```
:::
::: {.column style="width: 5%;"}
:::
::: {.column style="width: 47.5%; padding-top: 15px;"}
```{r}
#| attr-source: "style='height: 300px;'"

penguins |> descr(var = bill_depth_mm, round.digits = 3)
```
:::
::::

::: {.notes}
:::

## `summarize()` Approach {.smaller}

If you need more control over the descriptive statistics, then you will need to use `summarize()`.

```{r}
#| include: false

library(dplyr)
library(magrittr)
library(moments)
library(palmerpenguins)
library(tidyr)
```

:::: {.columns}
::: {.column style="width: 47.5%;"}
```{r}
#| attr-source: "style='height: 450px;'"

stats_summary <- function(x) {
  penguins |>
  summarize(
    n = n(),
    n_valid = .data[[x]] |>
      magrittr::extract(!is.na(.data[[x]])) |>
      length(),
    n_valid_per = n_valid |> # == (n_valid / n) * 100
      divide_by(n) |>
      multiply_by(100),
    mean = .data[[x]] |> mean(na.rm = TRUE),
    var = .data[[x]] |> var(na.rm = TRUE),
    sd = .data[[x]] |> sd(na.rm = TRUE),
    min = .data[[x]] |> min(na.rm = TRUE),
    quartile_1 = .data[[x]] |> quantile(prob = 0.25, na.rm = TRUE),
    median = .data[[x]] |> median(na.rm = TRUE),
    quartile_3 = .data[[x]] |> quantile(prob = 0.75, na.rm = TRUE),
    max = .data[[x]] |> max(na.rm = TRUE),
    iqr = .data[[x]] |> IQR(na.rm = TRUE),
    range = .data[[x]] |> range(na.rm = TRUE) |> diff(),
    skewness = .data[[x]] |> skewness(na.rm = TRUE),
    kurtosis = .data[[x]] |> kurtosis(na.rm = TRUE),
    .by = species
  ) |>
  pivot_longer(
    cols = -species,
    names_to = "statistic",
    values_to = "value"
  ) |>
  pivot_wider(
    names_from = species,
    values_from = value
  )
}
```
:::
::: {.column style="width: 5%;"}
:::
::: {.column style="width: 47.5%;"}
```{r}
stats_summary("bill_length_mm")
```
:::
::::

::: {.notes}
:::

## The Grammar of Tables {.smaller}

:::: {.columns}
::: {.column style="width: 30%; font-size: 0.9em;"}
[![](images/gt-hex-logo.svg){style="width: 120px; padding-top: 0px;"}](https://gt.rstudio.com/)

The `gt` package is the most powerful package for creating and customizing tables in R.

It provides a flexible **grammar** for table creation and styling.
:::
::: {.column style="width: 70%;"}
![](images/gt-parts-of-a-table.svg){fig-align="center" style="width: 100%; padding-top: 40px;"}
:::
::::

::: {.notes}
:::

## The `gt` Package {.smaller}

```{r}
library(dplyr)
library(gt)
library(palmerpenguins)
library(stringr)
```

```{r}
penguins_summary <-
  penguins |>
  filter(!is.na(sex)) |>
  summarize(
    n = n(),
    mean_body_mass_g = mean(body_mass_g, na.rm = TRUE),
    mean_bill_length_mm = mean(bill_length_mm, na.rm = TRUE),
    mean_flipper_length_mm = mean(flipper_length_mm, na.rm = TRUE),
    .by = c("species", "sex")
  ) |>
  mutate(sex = sex |> str_to_title()) |>
  arrange(species, sex)
```

## The `gt` Package {.smaller}

```{r}
penguins_summary
```

## It's All About Layers {.smaller .scrollable}

```{r}
#| code-fold: true

penguin_table <-
  penguins_summary |>
  gt(groupname_col = "species") |>
  cols_label(
    sex = "Sex",
    n = "N",
    mean_body_mass_g = "Body Mass (g)",
    mean_bill_length_mm = "Bill Length (mm)",
    mean_flipper_length_mm = "Flipper Length (mm)"
  )

penguin_table
```

## It's All About Layers {.smaller .scrollable}

```{r}
#| code-fold: true

penguin_table <-
  penguin_table |>
  tab_header(
    title = md("**Antarctic Penguin Characteristics**"),
    subtitle = "Comparison between species and sexes"
  )

penguin_table
```

## It's All About Layers {.smaller .scrollable}

```{r}
#| code-fold: true

penguin_table <-
  penguin_table |>
  fmt_number(
    columns = starts_with("mean"),
    decimals = 2
  )

penguin_table
```

## It's All About Layers {.smaller .scrollable}

```{r}
#| code-fold: true

penguin_table <-
  penguin_table |>
  data_color(
    columns = mean_body_mass_g,
    palette = "Blues"
  )

penguin_table
```

## It's All About Layers {.smaller .scrollable}

```{r}
#| code-fold: true

penguin_table <-
  penguin_table |>
  tab_source_note(
    source_note = "Source: Palmer Station LTER / palmerpenguins package"
  ) |>
  tab_footnote(
    footnote = "Averages calculated after removing missing values",
    locations = cells_column_labels(columns = starts_with("mean"))
  )

penguin_table
```

## It's All About Layers {.smaller .scrollable}

```{r}
#| code-fold: true

penguin_table <-
  penguin_table |>
  tab_style(
    style = cell_fill(color = "#E8F4F8"),
    locations = cells_row_groups()
  ) |>
  tab_style(
    style = cell_text(size = px(18)),
    locations = cells_title(groups = "title")
  ) |>
  tab_options(
    table.border.top.style = "solid",
    table.border.bottom.style = "solid",
    heading.border.bottom.style = "solid",
    column_labels.border.bottom.style = "solid",
    row_group.border.top.style = "solid",
    row_group.border.bottom.style = "solid"
  )

penguin_table
```

## Exercise (`gt`) {.smaller}

Using the [`starwars`](https://dplyr.tidyverse.org/reference/starwars.html) dataset from the [`dplyr`](https://dplyr.tidyverse.org) package, create a summary table that displays the mean *height* and *mass* of characters grouped by their species.

Customize the table with appropriate titles, labels, and formatting to enhance its readability.

```{r}
library(dplyr)
```

```{r}
#| attr-source: "style='height: 350px;'"

starwars |> glimpse()
```

::: {.notes}
:::

## Exercise (`gt`) {.smaller .scrollable}

**Solution**:

```{r}
#| code-fold: true

library(dplyr)
library(gt)
library(tidyr)

starwars_summary <-
  starwars |>
  drop_na(species, height, mass) |>
  summarize(
    mean_height = mean(height, na.rm = TRUE),
    mean_mass = mean(mass, na.rm = TRUE),
    .by = "species"
  )

starwars_summary |>
  gt() |>
  cols_label(
    species = "Species",
    mean_height = "Mean Height (cm)",
    mean_mass = "Mean Mass (kg)"
  ) |>
  tab_header(
    title = md("**Star Wars Character Characteristics**"),
    subtitle = "Mean height and mass by species"
  ) |>
  fmt_number(
    columns = starts_with("mean"),
    decimals = 2
  ) |>
  tab_source_note(
    source_note = "Source: Star Wars API / dplyr package"
  )
```

::: {.notes}
- **15-minute break** after this slide.
:::

## `gt` Extensions {.smaller}

The `gt` package also has several extensions that provide additional functionality for specific use cases.

:::: {.columns}
::: {.column style="width: 15%; padding-top: 15px;"}
[![](images/gtsummary-hex-logo.png){style="width: 120px;"}](https://www.danieldsjoberg.com/gtsummary/)
:::
::: {.column style="width: 85%; padding-top: 15px;"}
[`gtsummary`](https://www.danieldsjoberg.com/gtsummary/) provides a simple way to create publication-ready summary tables for statistical models and data frames.

```r
install.packages("gtsummary")
```
:::
::::

:::: {.columns}
::: {.column style="width: 15%;"}
[![](images/gtextras-hex-logo.png){style="width: 120px;"}](https://jthomasmock.github.io/gtExtras/)
:::
::: {.column style="width: 85%; padding-top: 15px;"}
[`gtextras`](https://jthomasmock.github.io/gtExtras/) provides additional themes, color scales, and utilities to enhance `gt` tables.

```r
install.packages("gtextras")
```
:::
::::

::: {.notes}
:::

## The Grammar of Graphics {.smaller}

:::: {.columns}
::: {.column style="width: 50%;"}
The Grammar of Graphics, by [**Leland Wilkinson**](https://en.wikipedia.org/wiki/Leland_Wilkinson), set the foundation thinking about data visualization.

We will based this part of the course on the principles found in this book.
:::
::: {.column style="width: 50%;"}
![](images/wilkinson-2005-book-cover.png){fig-align="center" style="width: 70%; padding-top: 0px;"}
:::
::::

::: footer
(Book cover image from @wilkinson2005)
:::

::: {.notes}
:::

## The `ggplot2` Package

![](images/allison-horst-figure-34.png){.nostretch fig-align="center" style="height: 550px;"}

::: footer
(Artwork by [Allison Horst](https://twitter.com/allison_horst))
:::

::: {.notes}
:::

## The `ggplot2` Package {.smaller}

:::: {.columns}
::: {.column style="width: 47.5%;"}
[![](images/ggplot2-hex-logo.png){style="width: 120px; padding-top: 0px;"}](https://ggplot2.tidyverse.org/)

The most powerful and flexible package for data visualization.

A [Tidyverse](https://www.tidyverse.org/) package based on the principles of *The Grammar of Graphics*.
:::
::: {.column style="width: 5%;"}
:::
::: {.column style="width: 47.5%;"}
![](images/wickham-2016-figure-1.png){style="width: 100%; padding-top: 30px;"}
:::
::::

::: footer
(Reproduced from @wickham2016a)
:::

::: {.notes}
:::

## It's All About Layers {.smaller}

:::: {.columns}
::: {.column style="width: 50%;"}
``` {r}
#| code-fold: true
#| warning: false
#| fig-height: 10

library(ggplot2)
library(palmerpenguins)

penguins |> ggplot()
```
:::
::: {.column style="width: 50%;"}
``` {r}
#| eval: false
#| code-fold: true

library(ggplot2)
library(palmerpenguins)

penguins |>
  ggplot(
    aes(
      x = body_mass_g,
      y = flipper_length_mm,
      color = species,
      shape = species
    )
  )
```

``` {r}
#| echo: false
#| warning: false
#| fig-height: 10

library(ggplot2)
library(palmerpenguins)
library(tidyr)

penguins |>
  drop_na(
    body_mass_g,
    flipper_length_mm,
    species
  ) |>
  ggplot(
    aes(
      x = body_mass_g,
      y = flipper_length_mm,
      color = species,
      shape = species
    )
  ) +
  theme(
    text = element_text(size = 20),
    legend.position = "none"
  )
```
:::
::::

::: {.notes}
:::

## It's All About Layers {.smaller}

:::: {.columns}
::: {.column style="width: 50%;"}
``` {r}
#| eval: false
#| code-fold: true

library(ggplot2)
library(palmerpenguins)

penguins |>
  ggplot(
    aes(
      x = body_mass_g,
      y = flipper_length_mm,
      color = species,
      shape = species
    )
  ) +
  geom_point(size = 4)
```

``` {r}
#| echo: false
#| warning: false
#| fig-height: 10

library(brandr)
library(ggplot2)
library(palmerpenguins)
library(tidyr)

penguins |>
  drop_na(
    body_mass_g,
    flipper_length_mm,
    species
  ) |>
  ggplot(
    aes(
      x = body_mass_g,
      y = flipper_length_mm,
      color = species,
      shape = species
    )
  ) +
  geom_point(size = 4) +
  scale_color_brand_d(alpha = 0.7) +
  theme(
    text = element_text(size = 20),
    legend.position = "none"
  )
```
:::
::: {.column style="width: 50%;"}
``` {r}
#| eval: false
#| code-fold: true

library(ggplot2)
library(palmerpenguins)

penguins |>
  ggplot(
    aes(
      x = body_mass_g,
      y = flipper_length_mm,
      color = species,
      shape = species
    )
  ) +
  geom_point() +
  geom_smooth(
    method = "lm",
    se = FALSE
  ) +
  labs(
    x = "Body Mass (g)",
    y = "Flipper Length (mm)",
    color = "Species",
    shape = "Species"
  )
```

``` {r}
#| echo: false
#| warning: false
#| fig-height: 10

library(brandr)
library(ggplot2)
library(palmerpenguins)
library(tidyr)

penguins |>
  drop_na(
    body_mass_g,
    flipper_length_mm,
    species
  ) |>
  ggplot(
    aes(
      x = body_mass_g,
      y = flipper_length_mm,
      color = species,
      shape = species
    )
  ) +
  geom_point(size = 4) +
  geom_smooth(
    method = "lm",
    se = FALSE,
    linewidth = 2
  ) +
  labs(
    x = "Body Mass (g)",
    y = "Flipper Length (mm)",
    color = "Species",
    shape = "Species"
  ) +
  scale_color_brand_d(alpha = 0.7) +
  theme(
    text = element_text(size = 20),
    legend.position = "none"
  )
```
:::
::::

::: {.notes}
:::

## Bar Plots {.smaller .nostretch}

```{r}
#| eval: false
#| code-fold: true

library(ggplot2)
library(palmerpenguins)

penguins |>
  ggplot(
    aes(
      x = island,
      fill = species
    )
  ) +
  geom_bar() +
  facet_wrap(
    facets = vars(species),
    ncol = 1
  ) +
  coord_flip() +
  labs(
    x = "Island",
    y = "Frequency"
  )
```

```{r}
#| echo: false
#| warning: false
#| fig-align: center

library(brandr)
library(ggplot2)
library(palmerpenguins)

penguins |>
  ggplot(
    aes(
      x = island,
      fill = species
    )
  ) +
  geom_bar(alpha = 0.8) +
  facet_wrap(
    facets = vars(species),
    ncol = 1
  ) +
  coord_flip() +
  scale_fill_brand_d() +
  labs(
    x = "Island",
    y = "Frequency"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

## Exercise (Bar Plot) {.smaller}

Create a bar plot using the [`starwars`](https://dplyr.tidyverse.org/reference/starwars.html) dataset that shows the frequency of characters by their `sex` variable.

Apply the following customizations:

- Drop any missing values from `sex` before creating the plot using the [`drop_na()`](https://tidyr.tidyverse.org/reference/drop_na.html) function from the [`tidyr`](https://tidyr.tidyverse.org) package.
- Select a fill color from the `colors()` function. View available color tones [here](https://r-charts.com/colors/).
- Use [`coord_flip()`](https://ggplot2.tidyverse.org/reference/coord_flip.html) to display horizontal bars.
- Add appropriate axis labels and a title to the plot.
- Include a caption that credits the data source.

::: {.notes}
:::

## Exercise (Bar Plot) {.smaller}

**Solution**:

```{r}
#| eval: false
#| code-fold: true

library(dplyr)
library(forcats)
library(ggplot2)
library(stringr)
library(tidyr)

starwars |>
  drop_na(sex) |>
  mutate(
    sex = sex |>
      str_to_title() |>
      as.factor() |>
      fct_infreq()
  ) |>
  ggplot(aes(x = sex)) +
  geom_bar(fill = "dodgerblue4") +
  coord_flip() +
  labs(
    title = "Distribution of Star Wars Characters by Sex",
    x = "Sex",
    y = "Frequency",
    caption = "Source: Star Wars API / dplyr package"
  )
```

```{r}
#| echo: false
#| warning: false
#| fig-align: center

library(brandr)
library(dplyr)
library(forcats)
library(ggplot2)
library(stringr)
library(tidyr)

starwars |>
  drop_na(sex) |>
  mutate(
    sex = sex |>
      str_to_title() |>
      as.factor() |>
      fct_infreq()
  ) |>
  ggplot(aes(x = sex)) +
  geom_bar(fill = get_brand_color("blue")) +
  coord_flip() +
  labs(
    title = "Distribution of Star Wars Characters by Sex",
    x = "Sex",
    y = "Frequency",
    caption = "Source: Star Wars API / dplyr package"
  )
```

::: {.notes}
:::

## Histograms {.smaller .nostretch}

```{r}
#| eval: false
#| code-fold: true

library(ggplot2)
library(palmerpenguins)

penguins |>
  ggplot(
    aes(
      x = flipper_length_mm,
      fill = species
    )
  ) +
  geom_histogram(
    alpha = 0.5,
    position = "identity"
  ) +
  labs(
    x = "Flipper Length (mm)",
    y = "Frequency",
    fill = "Species"
  )
```

```{r}
#| echo: false
#| warning: false
#| fig-align: center

library(brandr)
library(ggplot2)
library(palmerpenguins)
library(tidyr)

penguins |>
  drop_na(
    flipper_length_mm,
    species
  ) |>
  ggplot(
    aes(
      x = flipper_length_mm,
      fill = species
    )
  ) +
  geom_histogram(
    alpha = 0.5,
    position = "identity"
  ) +
  scale_fill_brand_d() +
  labs(
    x = "Flipper Length (mm)",
    y = "Frequency",
    fill = "Species"
  )
```

## Exercise (Histogram) {.smaller}

The [`ggplot2`](https://ggplot2.tidyverse.org/) package includes the [`diamonds`](https://ggplot2.tidyverse.org/reference/diamonds.html) dataset containing information about diamond quality and price. Using this dataset, create a histogram to visualize the distribution of the `price` variable.

Apply the following customizations:

- Select a fill color from the `colors()` function. View available color tones [here](https://r-charts.com/colors/).
- Add appropriate axis labels and a title to the plot.
- Include a caption that credits the data source.

::: {.notes}
:::

## Exercise (Histogram) {.smaller}

```{r}
library(ggplot2)
```

```{r}
diamonds |> glimpse()
```

::: {.notes}
:::

## Exercise (Histogram) {.smaller}

**Solution**:

```{r}
#| eval: false
#| code-fold: true

library(ggplot2)
library(tidyr)

diamonds |>
  ggplot(aes(x = price)) +
  geom_histogram(
    fill = "goldenrod4",
    color = "white"
  ) +
  labs(
    title = "Distribution of Diamond Prices",
    x = "Price (USD)",
    y = "Frequency",
    caption = "Source: ggplot2 package"
  )
```

```{r}
#| echo: false
#| warning: false
#| fig-align: center

library(brandr)
library(ggplot2)
library(tidyr)

diamonds |>
  drop_na(price) |>
  ggplot(aes(x = price)) +
  geom_histogram(
    fill = get_brand_color("comp-blue-1"),
    color = "white"
  ) +
  labs(
    title = "Distribution of Diamond Prices",
    x = "Price (USD)",
    y = "Frequency",
    caption = "Source: ggplot2 package"
  )
```

## Boxplots {.smaller .nostretch}

```{r}
#| eval: false
#| code-fold: true

library(ggplot2)
library(palmerpenguins)
library(tidyr)

penguins |>
  drop_na(
    bill_length_mm,
    species
  ) |>
  ggplot(
    aes(
      x = species,
      y = bill_length_mm,
      fill = species
    )
  ) +
  geom_boxplot(
    outlier.color = "red"
  ) +
  geom_jitter(
   width = 0.2,
   alpha = 0.1
  ) +
  labs(
    x = "Species",
    y = "Bill Length (mm)",
    fill = "Species"
  )
```

```{r}
#| echo: false
#| warning: false
#| fig-align: center

library(brandr)
library(ggplot2)
library(palmerpenguins)
library(tidyr)

penguins |>
  drop_na(
    bill_length_mm,
    species
  ) |>
  ggplot(
    aes(
      x = species,
      y = bill_length_mm,
      fill = species
    )
  ) +
  geom_boxplot(
    outlier.color = "red"
  ) +
  geom_jitter(
   width = 0.2,
   alpha = 0.1
  ) +
  scale_fill_brand_d(alpha = 0.7) +
  labs(
    x = "Species",
    y = "Bill Length (mm)",
    fill = "Species"
  )
```

## Exercise (Boxplot) {.smaller}

The [`ggplot2`](https://ggplot2.tidyverse.org/) package includes the [`msleep`](https://ggplot2.tidyverse.org/reference/msleep.html) dataset containing information about the sleep habits of various mammals. Using this dataset, create a boxplot to visualize the distribution of the `sleep_total` variable across different `vore` (dietary categories).

Apply the following customizations:

- Drop any missing values for `sleep_total` and `vore` before creating the plot using the [`drop_na()`](https://tidyr.tidyverse.org/reference/drop_na.html) function from the [`tidyr`](https://tidyr.tidyverse.org) package.
- Use different fill colors for each `vore` category by mapping the fill aesthetic to the `vore` variable.
- Add appropriate axis labels and a title to the plot.
- Include a caption that credits the data source.

::: {.notes}
:::

## Exercise (Boxplot) {.smaller}

```{r}
library(ggplot2)
```

```{r}
msleep |> glimpse()
```

::: {.notes}
:::

## Exercise (Boxplot) {.smaller}

**Solution**:

```{r}
#| eval: false
#| code-fold: true

library(ggplot2)
library(tidyr)

msleep |>
  drop_na(
    sleep_total,
    vore
  ) |>
  ggplot(
    aes(
      x = vore,
      y = sleep_total,
      fill = vore
    )
  ) +
  geom_boxplot() +
  labs(
    title = "Distribution of Total Sleep by Dietary Category",
    x = "Dietary Category (Vore)",
    y = "Total Sleep (hours)",
    caption = "Source: ggplot2 package"
  )
```

```{r}
#| echo: false
#| warning: false
#| fig-align: center

library(brandr)
library(ggplot2)
library(tidyr)

msleep |>
  drop_na(
    sleep_total,
    vore
  ) |>
  ggplot(
    aes(
      x = vore,
      y = sleep_total,
      fill = vore
    )
  ) +
  geom_boxplot() +
  scale_fill_brand_d(alpha = 0.7) +
  labs(
    title = "Distribution of Total Sleep by Dietary Category",
    x = "Dietary Category (Vore)",
    y = "Total Sleep (hours)",
    caption = "Source: ggplot2 package"
  )
```

## Scatter Plots {.smaller .nostretch}

```{r}
#| eval: false
#| code-fold: true

library(ggplot2)
library(palmerpenguins)
library(tidyr)

penguins |>
  ggplot(
    aes(
      x = body_mass_g,
      y = flipper_length_mm,
      color = species,
      shape = species
    )
  ) +
  geom_point() +
  geom_smooth(
    method = "lm",
    formula = y ~ x,
    se = FALSE
  ) +
  labs(
    x = "Body Mass (g)",
    y = "Flipper Length (mm)",
    color = "Species",
    shape = "Species"
  )
```

```{r}
#| echo: false
#| warning: false
#| fig-align: center

library(brandr)
library(ggplot2)
library(palmerpenguins)
library(tidyr)

penguins |>
  drop_na(
    body_mass_g,
    flipper_length_mm,
    species
  ) |>
  ggplot(
    aes(
      x = body_mass_g,
      y = flipper_length_mm,
      color = species,
      shape = species
    )
  ) +
  geom_point(size = 2) +
  geom_smooth(
    method = "lm",
    formula = y ~ x,
    se = FALSE
  ) +
  scale_color_brand_d(alpha = 0.7) +
  labs(
    x = "Body Mass (g)",
    y = "Flipper Length (mm)",
    color = "Species",
    shape = "Species"
  )
```

## Exercise (Scatter Plot) {.smaller}

The [`ggplot2`](https://ggplot2.tidyverse.org/) package includes the [`mpg`](https://ggplot2.tidyverse.org/reference/mpg.html) dataset containing information about various car models and their fuel efficiency. Using this dataset, create a scatter plot to visualize the relationship between `displ` (engine displacement) and `hwy` (highway miles per gallon).

Apply the following customizations:

- Add a regression line using the [`geom_smooth()`](https://ggplot2.tidyverse.org/reference/geom_smooth.html) function.
- Add appropriate axis labels and a title to the plot.
- Include a caption that credits the data source.

::: {.notes}
:::

## Exercise (Scatter Plot) {.smaller}

```{r}
library(ggplot2)
```

```{r}
mpg |> glimpse()
```

::: {.notes}
:::

## Exercise (Scatter Plot) {.smaller}

**Solution**:

```{r}
#| eval: false
#| code-fold: true

library(ggplot2)

mpg |>
  ggplot(
    aes(
      x = displ,
      y = hwy
    )
  ) +
  geom_point() +
  geom_smooth() +
  labs(
    title = "Relationship between Engine Displacement and Highway MPG",
    x = "Engine Displacement (L)",
    y = "Highway Miles per Gallon",
    caption = "Source: ggplot2 package"
  )
```

```{r}
#| echo: false
#| fig-align: center

library(ggplot2)

mpg |>
  ggplot(
    aes(
      x = displ,
      y = hwy
    )
  ) +
  geom_point(size = 2) +
  geom_smooth() +
  labs(
    title = "Relationship between Engine Displacement and Highway MPG",
    x = "Engine Displacement (L)",
    y = "Highway Miles per Gallon",
    caption = "Source: ggplot2 package"
  )
```

::: {.notes}
:::

## Facets {.smaller .nostretch}

```{r}
#| eval: false
#| code-fold: true

library(dplyr)
library(ggplot2)
library(magrittr)
library(palmerpenguins)
library(stringr)

penguins |>
  mutate(
    sex = sex |> str_to_title()
  ) |>
  ggplot(
    aes(
      x = body_mass_g,
      y = flipper_length_mm,
      color = sex
    )
  ) +
  geom_point() +
  geom_smooth(
    method = "lm",
    formula = y ~ x,
    se = FALSE,
    color = "black"
  ) +
  facet_wrap(vars(species)) +
  labs(
    x = "Body Mass (g)",
    y = "Flipper Length (mm)",
    color = "Sex"
  )
```

```{r}
#| echo: false
#| warning: false
#| fig-align: center

library(brandr)
library(dplyr)
library(ggplot2)
library(magrittr)
library(palmerpenguins)
library(stringr)
library(tidyr)

penguins |>
  drop_na(
    body_mass_g,
    flipper_length_mm,
    sex
  ) |>
  mutate(
    sex = sex |> str_to_title()
  ) |>
  ggplot(
    aes(
      x = body_mass_g,
      y = flipper_length_mm,
      color = sex
    )
  ) +
  geom_point(size = 2) +
  geom_smooth(
    method = "lm",
    formula = y ~ x,
    se = FALSE,
    color = get_brand_color("black")
  ) +
  scale_color_brand_d(alpha = 0.7) +
  facet_wrap(vars(species)) +
  labs(
    x = "Body Mass (g)",
    y = "Flipper Length (mm)",
    color = "Sex"
  )
```

## Combined Plots {.smaller .nostretch}

```{r}
#| eval: false
#| code-fold: true

library(ggplot2)
library(palmerpenguins)
library(patchwork)

plot_hist <-
  penguins |>
  ggplot(
    aes(
      x = flipper_length_mm,
      fill = species
    )
  ) +
  geom_histogram(
    alpha = 0.5,
    position = "identity"
  ) +
  labs(
    x = "Flipper Length (mm)",
    y = "Frequency"
  ) +
  theme(legend.position = "none")

plot_boxplot <-
  penguins |>
  ggplot(
    aes(
      x = species,
      y = bill_length_mm,
      fill = species
    )
  ) +
  geom_boxplot(outlier.color = "red") +
  geom_jitter(
    width = 0.2,
    alpha = 0.1
  ) +
  labs(
    x = "Species",
    y = "Bill Length (mm)",
    fill = "Species"
  ) +
  theme(
    axis.title.x = element_blank(),
    legend.position = "none"
  )

plot_scatter <-
  penguins |>
  drop_na(
    body_mass_g,
    flipper_length_mm,
    species
  ) |>
  ggplot(
    aes(
      x = body_mass_g,
      y = flipper_length_mm,
      color = species,
      shape = species
    )
  ) +
  geom_point() +
  geom_smooth(
    method = "lm",
    formula = y ~ x,
    se = FALSE
  ) +
  labs(
    x = "Body Mass (g)",
    y = "Flipper Length (mm)",
    color = "Species",
    shape = "Species"
  ) +
  theme(legend.position = "none")

(plot_hist + plot_boxplot) / plot_scatter + plot_annotation(tag_levels = "A")
```

```{r}
#| echo: false
#| warning: false
#| fig-align: center

library(brandr)
library(ggplot2)
library(palmerpenguins)
library(patchwork)
library(tidyr)

plot_hist <-
  penguins |>
  drop_na(
    flipper_length_mm,
    species
  ) |>
  ggplot(
    aes(
    x = flipper_length_mm,
    fill = species
    )
  ) +
  geom_histogram(
    bins = 30,
    alpha = 0.5,
    position = "identity"
  ) +
  labs(
    x = "Flipper Length (mm)",
    y = "Frequency"
  ) +
  scale_fill_brand_d() +
  theme(legend.position = "none")

plot_boxplot <-
  penguins |>
  drop_na(
    bill_length_mm,
    species
  ) |>
  ggplot(
    aes(
      x = species,
      y = bill_length_mm,
      fill = species
    )
  ) +
  geom_boxplot(outlier.color = "red") +
  geom_jitter(
    width = 0.2,
    alpha = 0.1
  ) +
  labs(
    x = "Species",
    y = "Bill Length (mm)",
    fill = "Species"
  ) +
  scale_fill_brand_d(alpha = 0.7) +
  theme(
    axis.title.x = element_blank(),
    legend.position = "none"
  )

plot_scatter <-
  penguins |>
  drop_na(body_mass_g, flipper_length_mm, species) |>
  ggplot(
    aes(
      x = body_mass_g,
      y = flipper_length_mm,
      color = species,
      shape = species
    )
  ) +
  geom_point(size = 2) +
  geom_smooth(
    method = "lm",
    formula = y ~ x,
    se = FALSE
  ) +
  labs(
    x = "Body Mass (g)",
    y = "Flipper Length (mm)",
    color = "Species",
    shape = "Species"
  ) +
  scale_color_brand_d(alpha = 0.7) +
  theme(legend.position = "none")

(plot_hist + plot_boxplot) / plot_scatter + plot_annotation(tag_levels = "A")
```

::: {.notes}
:::

## Correlation Matrices {.smaller .nostretch}

```{r}
#| eval: false
#| code-fold: true

library(dplyr)
library(GGally)
library(ggplot2)
library(palmerpenguins)

penguins |>
  select(species, body_mass_g, ends_with("_mm")) |>
  ggpairs(aes(color = species))
```

```{r}
#| echo: false
#| warning: false
#| fig-align: center
#| fig-width: 12
#| fig-height: 6

library(brandr)
library(dplyr)
library(GGally)
library(ggplot2)
library(palmerpenguins)
library(tidyr)

penguins |>
  select(species, body_mass_g, ends_with("_mm")) |>
  drop_na(species, body_mass_g, ends_with("_mm")) |>
  ggpairs(aes(color = species)) +
  scale_color_brand_d(alpha = 0.7) +
  scale_fill_brand_d(alpha = 0.7)
```

::: {.notes}
The [`GGally`](https://ggobi.github.io/ggally/index.html) package is an extension of `ggplot2`.
:::

## Color Palettes {.smaller .scrollable}

Color palettes can be sequential, diverging, or qualitative (discrete). Here are some examples of two popular packages for color palettes in R.

:::: {.columns}
::: {.column style="width: 50;"}
[`viridis`](https://sjmgarnier.github.io/viridis/): Colorblind-Friendly Color Maps

```{r}
#| code-fold: true
#| warning: false
#| fig-align: center

library(ggplot2)
library(palmerpenguins)
library(tidyr)
library(viridis)

penguins |>
  drop_na(
    flipper_length_mm,
    species
  ) |>
  ggplot(
    aes(
      x = flipper_length_mm,
      fill = species
    )
  ) +
  geom_density(
    alpha = 0.5,
    position = "identity"
  ) +
  scale_fill_viridis(discrete = TRUE) +
  labs(
    x = "Flipper Length (mm)",
    y = "Density",
    fill = "Species"
  ) +
  theme(
    text = element_text(size = 20),
    legend.position = "none"
  )
```
:::
::: {.column style="width: 50%;"}
[`RColorBrewer`](https://colorbrewer2.org/#type=qualitative&scheme=Set1&n=6): Common Color Palettes

```{r}
#| code-fold: true
#| warning: false
#| fig-align: center

library(ggplot2)
library(palmerpenguins)
library(tidyr)

penguins |>
  drop_na(
    flipper_length_mm,
    species
  ) |>
  ggplot(
    aes(
      x = flipper_length_mm,
      fill = species
    )
  ) +
  geom_density(
    alpha = 0.5,
    position = "identity"
  ) +
  scale_fill_brewer(palette = "Set1") +
  labs(
    x = "Flipper Length (mm)",
    y = "Density",
    fill = "Species"
  ) +
  theme(
    text = element_text(size = 20),
    legend.position = "none"
  )
```
:::
::::

::: {.notes}
:::

## How to Choose the Right Vis. {.smaller}

Check out the amazing work by [Yan Holtz](https://github.com/holtzy). Visit [From Data to Viz](https://www.data-to-viz.com/) too see the diagram below and many others.

![](images/holtz-2018-from-data-to-viz-poster-adapted.png){.nostretch fig-align="center" style="width: 100%; padding-top: 50px;"}

::: footer
(Artwork by [Yan Holtz](https://github.com/holtzy))
:::

::: {.notes}
:::

## The R Graph Gallery {.smaller}

Another amazing work by [Yan Holtz](https://github.com/holtzy) is the [R Graph Gallery](https://r-graph-gallery.com/), which provides numerous examples of R graphics and how to create them.

![](images/holtz-connection-map.png){.nostretch fig-align="center" style="width: 100%; padding-top: 15px;"}

::: footer
(Artwork by [Yan Holtz](https://www.data-to-viz.com/story/MapConnection.html))
:::

::: {.notes}
:::

## How to Learn More {.smaller}

:::: {.columns}
::: {.column style="width: 47.5%;"}
[![](images/wickham-2016-book-cover.png){fig-align="center" style="width: 73.5%;"}](https://ggplot2-book.org/)
:::
::: {.column style="width: 5%;"}
:::
::: {.column style="width: 47.5%;"}
[![](images/chang-2018-book-cover.png){fig-align="center" style="width: 85%;"}](https://r-graphics.org/)
:::
::::

::: footer
(Book cover image from @wickham2016a and @chang2018)
:::

::: {.notes}
- **15-minute break** or **day end** after this slide.
:::
