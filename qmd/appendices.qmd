## A Bit of History {.smaller}

:::: {.columns}
::: {.column style="width: 50%;"}
[**Abacus**](https://en.wikipedia.org/wiki/Abacus) (~between 2700 and 2300 BCE) (Sumerians) [@ifrah2001]

[**Pascalina**](https://en.wikipedia.org/wiki/Pascaline) (1642) (Blaise Pascal (1623–1662)) [@ifrah2001]

[**Babbage’s Difference Engine**](https://en.wikipedia.org/wiki/Difference_engine) (Charles Babbage (1792–1871))
:::
::: {.column style="width: 50%;"}
![](images/richards-1950-chinese-abacus.jpg){fig-align="center" style="width: 80%; padding-top: 100px;"}
:::
::::

::: footer
(Photo by [Mark Richards](https://www.computerhistory.org/revolution/calculators/1/1/134?position=0))
:::

::: {.notes}
:::

## A Bit of History {.smaller}

:::: {.columns}
::: {.column style="width: 50%;"}
**Keep in mind**

- 1st World War (1914–1918)
- 2nd World War (1939–1945)

[**Universal Turing machine**](https://en.wikipedia.org/wiki/Universal_Turing_machine) (Alan Turing) [@turing1937]

[**"von Neumann Architecture"**](https://en.wikipedia.org/wiki/Von_Neumann_architecture) (1945) [@vonneumann1993a]

[**ENIAC**](https://en.wikipedia.org/wiki/ENIAC) (1945)
:::
::: {.column style="width: 50%;"}
![](images/science-history-images-eniac-figure-1.jpg){fig-align="center" style="width: 80%; padding-top: 50px;"}
:::
::::

::: footer
(Photo by [Science History Images/Alamy Stock Photo](https://www.alamy.com/technicians-connecting-wires-of-eniac-image386295734.html))
:::

::: {.notes}
- [Enigma machine](https://en.wikipedia.org/wiki/Enigma_machine)
:::

## Debugging {.smaller}

![](images/allison-horst-figure-35.png){fig-align="center" style="width: 90%; padding-top: 0px;"}

::: footer
(Artwork by [Allison Horst](https://twitter.com/allison_horst))
:::

::: {.notes}
:::

## The Tidy Data Manifesto {.smaller}

::: footer
[@wickham2014a]
:::

::: {.notes}
:::

## Tidy Data {.smaller .nostretch}

![](images/allison-horst-figure-14.jpg){fig-align="center" style="width: 100%;"}

::: footer
(Artwork by [Allison Horst](https://allisonhorst.com/horst-hill-collaborations))
:::

::: {.notes}
:::

## Tidy Data {.smaller .nostretch}

![](images/allison-horst-figure-19.jpg){fig-align="center" style="width: 80%; padding-top: 50px;"}

::: footer
(Artwork by [Allison Horst](https://allisonhorst.com/horst-hill-collaborations))
:::

## Big Data {.smaller}

:::: {.columns}
::: {.column style="width: 40%;"}
> **Big data will be dead in 5 Years**: Everything will be big data, so it won't need a special name. [@gavin2020]
:::
::: {.column style="width: 60%;"}
![](images/david-fletcher-big-data.jpeg){fig-align="center" style="width: 100%;"}
:::
::::

::: footer
(Artwork by [David Fletcher](https://en.wikipedia.org/wiki/David_Fletcher_(cartoonist)))
:::

::: {.notes}
:::

## Big Data Wrangling {.smaller}

**Working with big data using Excel or GUI-based (Graphical User Interface) statistical software is extremely challenging, if not impossible**.

Excel, for example, can struggle with performance issues and has a maximum row limit (1,048,576 rows), which is often insufficient for big data projects.

The best tools for handling big data are [R](https://www.r-project.org/) and [Python](https://www.python.org/).

::: {.notes}
:::

## Fair Principles {.smaller .nostretch}

![](images/fair-data-principles.png){fig-align="center" style="width: 75%; padding-top: 75px;"}

::: footer
(To learn more see: @wilkinson2016 and @gofairinitiative)
:::

::: {.notes}
:::

## Data Management Plans {.smaller}

A data management plan (DMP) is a formal document that outlines how data will be managed throughout the research process.

- [FAPESP](https://fapesp.br/gestaodedados)
- [DMPTool](https://dmptool.org/)
- [DMPonline](https://dmponline.dcc.ac.uk/)

::: {style="padding-top: 25px;"}
**Example**: [Associations between the duration and quality of sleep of pregnant women in the third trimester with the duration of labor](https://doi.org/10.48321/D1PS4M)
:::

::: {.notes}
:::

## Strings {.smaller}

::: {.notes}
:::

## Regular Expressions {.smaller}

::: {.notes}
:::

## Lookup Tables {.smaller}

::: {.notes}
:::

## Joins {.smaller}

::: {.notes}
:::

## The `visdat` Package {.smaller}

:::: {.columns}
::: {.column style="width: 15%;"}
[![](images/visdat-hex-logo.svg){style="width: 120px;"}](https://docs.ropensci.org/visdat/)
:::
::: {.column style="width: 85%; padding-top: 15px;"}
`visdat` helps you diagnose missing values and other potential problems in your data.

```r
install.packages("visdat")
```
:::
::::

```{r}
#| eval: false

library(palmerpenguins)
library(visdat)

penguins |> vis_dat()
```

::: {.notes}
:::

## What Test Should I Use? {.smaller}

::: {style="padding-top: 50px;"}
```{r}
#| echo: false

dplyr::tibble(
  type_of_data = c(
    "Normally distributed continuous data<br>(summarized as mean)",
    paste0(
      "Ranks, scores, and non-normally<br>distributed continuous data<br>",
      "(Summarized as median)"
    ),
    "Dichotomous data<br>(Summarized as proportion)"
  ),
  two_data_sets_paired = c(
    "Paired t-test",
    "Wilcoxon signed-rank test",
    "Mc Nemar's test"
  ),
  two_data_sets_unpaired = c(
    "Unpaired t-test",
    "Mann-Whitney U test",
    "Fishers test or Chi-square test"
  ),
  more_than_two_data_sets_paired = c(
    "Repeated measures ANOVA",
    "Friedman's test",
    "Cochrane Q test"
  ),
  more_than_two_data_sets_unpaired = c(
    "One-way ANOVA",
    "Kruskal-Wallis test",
    "Chi-square test"
  ),
  correlation_analysis = c(
    "Pearson's correlation",
    "Spearman's rank correlation",
    "Contingency coefficient"
  ),
  regression_analysis = c(
    "Linear regression",
    "Nonparametric regression",
    "Logistic regression"
  )
) |>
  gt::gt() |>
  gt::tab_spanner(
    label = "Comparison Analysis",
    columns = c(
      two_data_sets_paired, two_data_sets_unpaired,
      more_than_two_data_sets_paired, more_than_two_data_sets_unpaired
    )
  ) |>
  gt::tab_spanner(
    label = "Other Analysis",
    columns = c(correlation_analysis, regression_analysis)
  ) |>
  gt::cols_label(
    type_of_data = "Type of Data",
    two_data_sets_paired = "2 Data Sets - Paired",
    two_data_sets_unpaired = "2 Data Sets - Unpaired",
    more_than_two_data_sets_paired = "More than 2 Data Sets - Paired",
    more_than_two_data_sets_unpaired = "More than 2 Data Sets - Unpaired",
    correlation_analysis = "Correlation Analysis",
    regression_analysis = "Regression Analysis"
  ) |>
  gt::fmt_markdown(columns = type_of_data) |>
  gt::tab_style(
    style = gt::cell_text(weight = "bold"),
    locations = gt::cells_column_labels()
  )
```
:::

::: footer
(Adapted from @najmi2021)
:::

::: {.notes}
:::

## ANOVA: Power Analysis {.smaller}

```{r}
library(pwrss)
```

```{r}
pwrss.f.ancova(
  eta2 = 0.01,
  n.way = 1,
  n.levels = 3,
  n.covariates = 0,
  alpha = 0.05,
  n = NULL,
  power = 0.8
)
```

::: {.notes}
:::

## ANOVA: Power Analysis {.smaller}

```{r}
#| eval: false
#| warning: false

library(pwrss)

power.f.test(
  ncp = pwr_analysis$ncp,
  df1 = pwr_analysis$df1,
  df2 = pwr_analysis$df2,
  alpha = 0.05,
  plot = TRUE
)
```

::: {.notes}
:::

## Dig. Objects & Ver. Control {.smaller}

:::: {.columns}
::: {.column style="width: 47%;"}
![](images/doi-foundation-logo.svg){fig-align="center" style="width: 100%; padding-top: 75px;"}
:::
::: {.column style="width: 6%;"}
:::
::: {.column style="width: 47%;"}
![](images/version-control.png){fig-align="center" style="width: 60%; padding-top: 60px;"}
:::
::::

::: {.notes}
:::

## Open Licenses {.smaller}

A unlicensed work is an "all rights reserved" work. This means that you can't use it without the author's permission.

:::: {.columns}
::: {.column style="width: 50%; font-size: 0.85em;"}
* Licenses for data
  * [Open Knowledge Foundation](https://okfn.org/)

* Licenses for software/code
  * [OSI Approved Licenses](https://opensource.org/licenses)
  * [The MIT license](https://opensource.org/license/mit)
  * [GNU General Public License version 3](https://opensource.org/license/gpl-3-0)

* Licenses for _everything else_ (e.g., documents, figures)
  * [Creative Commons](https://creativecommons.org/)
  * [CC BY 4.0](https://creativecommons.org/licenses/by/4.0/)
:::
::: {.column style="width: 50%;"}
![](images/mit-license-logo.png){fig-align="center" style="width: 50%;"}

![](images/cc-license-logo.png){fig-align="center" style="width: 50%;"}
:::
::::

## Dynamic Documents {.smaller}

Dynamic documents seamlessly integrate text with output from a programming language, automatically updating the output whenever the code is executed.

::::: {.columns}
:::: {.column style="width: 50%; font-size: 0.9em; padding-top: 0px;"}
- [Quarto](https://quarto.org/) (R, Python, Julia) (+Pandoc)
- [Jupyter](https://jupyter.org/) (Python, R, Julia, +37 languages)
- [Rmarkdown](https://rmarkdown.rstudio.com/) (R) (+Pandoc)

::: {style="padding-top: 10px;"}
**Examples**

- External-link: [Central limit theorem](https://danielvartan.github.io/central-limit-theorem/)
- External-link: [Sample size](https://danielvartan.github.io/sample-size/)
- External-link: [Fisher's hypothesis](https://danielvartan.github.io/fisher-hypothesis/)
:::
::::
:::: {.column style="width: 50%; padding-top: 25px;"}
![](images/quarto-logo.png){fig-align="center" style="width: 75%;"}

![](images/jupyter-logo.png){fig-align="center" style="width: 40%;"}
::::
:::::

::: {.notes}
- You can write articles with dynamic documents.
- Difference from LaTeX.
- Quarto as an evolution from Rmarkdown.
- Jupyter can be used with Quarto.
:::

## Pipelines {.smaller .nostretch}

Pipeline tools coordinate the pieces of computationally demanding analysis projects. They can be used to automate the execution of a series of tasks.

:::: {.columns}
::: {.column style="width: 25%;"}
[![](images/targets-logo.png){fig-align="center" style="width: 75%; padding-top: 70px;"}](https://github.com/ropensci/targets)
:::
::: {.column style="width: 75%;"}
[![](images/targets-pipeline.png){fig-align="center" style="width: 70%; padding-top: 0px;"}](https://books.ropensci.org/targets/walkthrough.html#inspect-the-pipeline)
:::
::::

::: footer
(Reproduced from @landau)
:::

::: {.notes}
:::

## Reproducible Env. {.smaller}

Reproducible environments ensure that your code will run the same way on different machines and regardless of the time.

:::: {.columns}
::: {.column style="width: 50%;"}
[![](images/renv-hex-logo.png){fig-align="center" style="width: 75%; padding-top: 25px;"}](https://rstudio.github.io/renv/)
:::
::: {.column style="width: 50%;"}
[![](images/podman-hex-logo.png){fig-align="center" style="width: 75%; padding-top: 25px;"}](https://podman.io/)
:::
::::

::: {.notes}
:::

## App. Prog. Interf. (APIs) {.smaller}

::: {style="font-size: 0.8em;"}
APIs are a set of rules that allow different software applications to communicate with each other.
:::

:::: {.columns}
::: {.column style="width: 33%; font-size: 0.7em;"}
* [OSF API](https://developer.osf.io/)
* [Brazil's Central Bank APIs](https://dadosabertos.bcb.gov.br/dataset?res_format=API)
* [NASA's APIs](https://api.nasa.gov/)
:::
::: {.column style="width: 34%; font-size: 0.7em;"}
* [OpenAI API](https://platform.openai.com/docs/api-reference/introduction)
* [SIDRA API (IBGE)](https://api.sidra.ibge.gov.br/)
* [SISVAN API](https://opendatasus.saude.gov.br/dataset/sisvan-estado-nutricional/resource/3ead4331-6424-471f-a811-4edf22f58e00)
:::
::: {.column style="width: 33%; font-size: 0.7em;"}
![](images/api-symbol.png){fig-align="center" style="width: 40%;"}
:::
::::

```{r}
library(magrittr)
library(sidrar)
```

```{r}
#| eval: false

# Brazil's population in 2022 (Census data)
get_sidra(
  api = "/t/7358/n1/all/v/all/p/all/c2/6794/c287/100362/c1933/49039"
) |>
  suppressMessages() |>
  extract2("Valor") |>
  prettyNum(big.mark = ",")
#> [1] "216,284,269"
```

## KISS Principle {.nostretch}

![](images/kiss-principle.png){fig-align="center" style="width: 75%; padding-top: 50px;"}

## Some Other Things {.smaller}

We've only touched upon the vast landscape of open science. There are many other tools and concepts that we didn't cover, such as:

::: {.columns style="padding-top: 10px;"}
::: {.column style="width: 50%; font-size: 0.75em;"}
- Markup languages (e.g., [Markdown](https://daringfireball.net/projects/markdown/), [LaTeX](https://www.latex-project.org/))
- Open source softwares (e.g., [rOpenSci](https://ropensci.org/), [CRAN](https://cran.r-project.org/), [Bioconductor](https://www.bioconductor.org/), [PyPI](https://pypi))
- Version control systems (e.g. [Git](https://www.git-scm.com/), [SVN](https://subversion.apache.org/), [Semantic versioning](https://semver.org/))
- Database systems (e.g., [Relational databases](https://en.wikipedia.org/wiki/Relational_database), [NoSQL](https://en.wikipedia.org/wiki/NoSQL))
- Open source data management systems (e.g., [CKAN](https://www.ckan.org/) [Dataverse](https://dataverse.org/); [DSpace](https://dspace.lyrasis.org/))
:::
::: {.column style="width: 50%; font-size: 0.75em;"}
- Git-based repositories (e.g., [GitHub](https://github.com), [GitLab](https://gitlab.com))
- Open data formats (e.g., [CSV](https://en.wikipedia.org/wiki/Comma-separated_values), [JSON](https://www.json.org/json-en.html), [Apache Parquet](https://en.wikipedia.org/wiki/Apache_Parquet))
- Cloud computing (e.g., [AWS](https://aws.amazon.com/), [Google Cloud](https://cloud.google.com/), [Azure](https://azure.microsoft.com/))
- Open science policies (e.g., [FAPESP](https://fapesp.br/openscience/), [European Commission](https://research-and-innovation.ec.europa.eu/strategy/strategy-2020-2024/our-digital-future/open-science_en))
- Ethical data sharing practices (See @meyer2018 to learn more)
:::
:::

::: {.notes}
:::

## Some Other Things {.smaller .nostretch}

![](images/allison-horst-figure-9.png){fig-align="center" style="width: 90%; padding-top: 10px;"}

::: footer
(Artwork by [Allison Horst](https://allisonhorst.com/horst-hill-collaborations))
:::

::: {.notes}
:::

---

## Colors {.smaller}

Individual photoreceptors in the human eye are sensitive to different wavelengths of light, which we perceive as colors.

![](images/kandel-2021-figure-17-5-a.png){.nostretch fig-align="center" style="width: 75%;"}

::: footer
(Reproduced from @kandel2021[p. 394])
:::

::: {.notes}
:::

## Color Models {.smaller}

![](images/figma-figure-1.png){.nostretch fig-align="center" style="width: 60%;"}

::: footer
(Reproduced from @figma)
:::

::: {.notes}
:::

## Color Gamut {.smaller}

A [color gamut](https://en.wikipedia.org/wiki/Gamut) is the range of colors that can be represented in a given color model or by a specific device.


::: {.notes}
:::

## Color Mixing {.smaller}

Color representation on computer screens is based on the [RGB](https://en.wikipedia.org/wiki/RGB_color_model) color model, where colors are created by combining red, green, and blue light.

:::: {.columns}
::: {.column style="width: 47.5%; padding-top: 15px;"}
**Screen** (RGB)

![](images/color-vision-printing-2026-figure-1.jpg){style="width: 100%; padding-top: 0px;"}
:::
::: {.column style="width: 5%;"}
:::
::: {.column style="width: 47.5%; padding-top: 15px;"}
**Print** (CMYK)

![](images/color-vision-printing-2026-figure-2.jpg){style="width: 100%; padding-top: 0px;"}
:::
::::

::: footer
(Reproduced from [Color Vision Printing ](https://www.colorvisionprinting.com/blog/the-difference-between-cmyk-and-rgb-color-models?p=5))
:::

::: {.notes}
:::

## `colors()` {.smaller}

R provides a built-in set of named colors that can be used in visualizations and graphics. You can access the list of available colors using the `colors()` function. View all available color tones [here](https://r-charts.com/colors/).

:::: {.columns}
::: {.column style="width: 40%;"}
```{r}
colors() |> head(30)
```
:::
::: {.column style="width: 5%;"}
:::
::: {.column style="width: 55%;"}
![](images/neth-2026-figure-d-3.png){style="width: 100%; padding-top: 0px;"}
:::
::::

::: footer
(Reproduced from @neth2026)
:::

::: {.notes}
:::

## Hex Colors {.smaller}

Hex color codes are a way to represent [RGB](https://en.wikipedia.org/wiki/RGB_color_model) colors using hexadecimal (base 16) values. R and other programming languages use hex color codes to specify colors in visualizations and graphics.

:::: {.columns}
::: {.column style="width: 47.5%;"}
![](images/gremillion-2012-figure-2.png){style="width: 100%; padding-top: 150px;"}
:::
::: {.column style="width: 47.5%;"}
![](images/gremillion-2012-figure-1.png){style="width: 100%; padding-top: 0px;"}
:::
::::

::: footer
(Reproduced from @gremillion2012)
:::

::: {.notes}
:::

## ANOVA: Hypothesis {.smaller}

:::: {.columns}
::: {.column style="width: 50%; font-size: 0.85em;"}
[Is there a meaningful difference in flipper length between Adelie, Chinstrap, and Gentoo penguins?]{.brand-triad-blue-red .bold-black style="font-size: 1.1em;"}

To test this, we will perform a **One-Way ANOVA** using a randomization-based empirical null distribution approach.

To ensure [practical significance]{style="text-decoration: underline;"}, we will analyze the difference in means for its effect size, considering a 95% confidence interval.

Cohen's benchmark for a small effect size will be used as our Minimum Effect Size (MES) [@cohen1988a].
:::
::: {.column style="width: 50%; padding-top: 125px;"}
$$
\begin{cases}
\text{H}_{0}: \mu_{A} = \mu_{B} = \mu_{C} \\
\text{H}_{a}: \mu_{i} \neq \mu_{j}, \ \text{for some} \ i, j
\end{cases}
$$

$$
\begin{cases}
\text{H}_{0}: f < \text{MES} \\
\text{H}_{a}: f \geq \text{MES} \\
\end{cases}
$$
:::
::::

::: {.notes}
:::

## ANOVA: Boxplots {.smaller .nostretch}

```{r}
#| fig-align: center
#| code-fold: true
#| warning: false

library(brandr)
library(ggplot2)
library(palmerpenguins)
library(tidyr)

penguins |>
  drop_na(flipper_length_mm, species) |>
  ggplot(aes(x = species, y = flipper_length_mm, fill = species)) +
  geom_boxplot(outlier.color = "red") +
  geom_jitter(width = 0.2, alpha = 0.1) +
  scale_fill_brand_d(alpha = 0.7) +
  labs(x = "Species", y = "Flipper Length (mm)", fill = "Species")
```

::: {.notes}
:::

## ANOVA: Density Plots {.smaller .nostretch}

```{r}
#| fig-align: center
#| code-fold: true

library(brandr)
library(ggplot2)
library(palmerpenguins)
library(tidyr)

penguins |>
  drop_na(flipper_length_mm, species) |>
  ggplot(aes(x = flipper_length_mm, fill = species)) +
  geom_density(alpha = 0.7) +
  scale_fill_brand_d() +
  labs(x = "Flipper Length (mm)", y = "Density", fill = "Species")
```

::: {.notes}
:::

## ANOVA: Power Analysis {.smaller}

```{r}
library(dplyr)
library(palmerpenguins)
library(tidyr)
```

:::: {.columns}
::: {.column style="width: 50%; padding-top: 15px;"}
```{r}
adelie <-
  penguins |>
  filter(species == "Adelie") |>
  drop_na() |>
  pull(flipper_length_mm)

adelie |> length()
```

```{r}
chinstrap <-
  penguins |>
  filter(species == "Chinstrap") |>
  drop_na() |>
  pull(flipper_length_mm)

chinstrap |> length()
```
:::
::: {.column style="width: 50%; padding-top: 15px;"}
```{r}
gentoo <-
  penguins |>
  filter(species == "Gentoo") |>
  drop_na() |>
  pull(flipper_length_mm)

gentoo |> length()
```
:::
::::

## ANOVA: Power Analysis {.smaller}

```{r}
library(pwr)
```

```{r}
pwr_analysis <- pwr.anova.test(
  k = 3,
  f = 0.25, # Cohen's f for medium effect sizes
  sig.level = 0.05,
  power = 0.8
)

pwr_analysis
```

::: {.notes}
:::

## ANOVA: Power Analysis {.smaller .nostretch}

```{r}
#| code-fold: true
#| warning: false
#| fig-align: center

library(pwr)

pwr_analysis |>
  plot.power.htest(
    xlab = "Sample size per group",
    ylab = "Power (1 - Beta)",
    main = NULL
  )
```

::: {.notes}
:::

## ANOVA: Observed Statistic {.smaller}

```{r}
library(dplyr)
library(infer)
library(palmerpenguins)
library(tidyr)
```

```{r}
observed_statistic <-
  penguins |>
  drop_na(flipper_length_mm, species) |>
  specify(flipper_length_mm ~ species) |>
  hypothesize(null = "independence") |>
  calculate(stat = "F")

observed_statistic
```

::: {.notes}
:::

## ANOVA: Null Distribution {.smaller}

```{r}
library(dplyr)
library(infer)
library(palmerpenguins)
library(tidyr)
```

```{r}
null_dist <-
  penguins |>
  drop_na(flipper_length_mm, species) |>
  specify(flipper_length_mm ~ species) |>
  hypothesize(null = "independence") |>
  generate(reps = 1000, type = "permute") |>
  calculate(stat = "F")

null_dist
```

::: {.notes}
:::

## ANOVA: Visualizing {.smaller .nostretch}

```{r}
#| code-fold: true
#| fig-align: center
#| fig-height: 7
#| fig-width: 15

library(infer)
library(ggplot2)

null_dist |>
  visualize(method = "both") +
  shade_p_value(
    obs_stat = observed_statistic,
    direction = "greater"
  ) +
  labs(
    title = NULL,
    x = "F-statistic",
    y = "Frequency"
  ) +
  theme(text = element_text(size = 14))
```

::: {.notes}
:::

## ANOVA: p-value {.smaller}

```{r}
#| warning: false

null_dist |>
  get_p_value(
    obs_stat = observed_statistic,
    direction = "two-sided"
  )
```

::: {.notes}
:::

## ANOVA: Tukey HSD {.smaller}

Tukey Honest Significant Differences (HSD) test.

```{r}
library(broom)
```

```r
aov(flipper_length_mm ~ species, data = penguins) |>
  TukeyHSD(conf.level = 0.95) |>
  tidy()
```

```{r}
#| echo: false

aov(flipper_length_mm ~ species, data = penguins) |>
  TukeyHSD(conf.level = 0.95) |>
  broom::tidy() |>
  rmarkdown::paged_table()
```

::: {.notes}
:::

## ANOVA: Effect Size {.smaller}

```{r}
library(effectsize)
```

```{r}
#| messages: false
#| warning: false

effect_size <-
  aov(flipper_length_mm ~ species, data = penguins) |>
  cohens_f()

effect_size
```

```{r}
effect_size[[2]] |>
  f_to_eta2() |>
  interpret_eta_squared(rules = "cohen1992")
```

::: {.notes}
:::

## ANOVA: Power Analysis {.smaller}

```{r}
library(pwr)
```

```{r}
pwr.anova.test(
  k = 3,
  n = min(length(adelie), length(chinstrap), length(gentoo)),
  f = effect_size[[2]],
  sig.level = 0.05
)
```

::: {.notes}
:::

## ANOVA: Conclusion {.smaller}

:::: {.columns}
::: {.column style="width: 60%; font-size: 0.8em;"}
[Is there a meaningful difference in flipper length between Adelie, Chinstrap, and Gentoo penguins?]{.brand-triad-blue-red .bold-black style="font-size: 1.1em;"}

Our analysis found a statistically significant difference in means ($\text{F}$ = 595, $p$-value < 0.001). The observed effect size was very large and exceed the Minimal Effect Size (MES) threshold ($f$ = 1.873, 95% CI [1.72, Inf]).

The power (1 - $\beta$) of the test is ~1, indicating that the probability of a false negative is very low.

Based on these results, we conclude that **there is a meaningful difference in flipper length between Adelie, Chinstrap, and Gentoo penguins**, with Gentoo penguins having significantly longer flippers, followed by Chinstrap penguins. Consequently, we reject the null hypothesis in favor of the alternative hypothesis.
:::
::: {.column style="width: 40%; padding-top: 130px;"}
$$
\begin{cases}
\text{H}_{0}: \mu_{A} = \mu_{B} = \mu_{C} \\
\text{H}_{a}: \mu_{i} \neq \mu_{j}, \ \text{for some} \ i, j
\end{cases}
$$

$$
\begin{cases}
\text{H}_{0}: f < \text{MES} \\
\text{H}_{a}: f \geq \text{MES} \\
\end{cases}
$$
:::
::::

::: {.notes}
- **15-minute break** after this slide.
:::

## Linear Reg.: Hypothesis {.smaller}

:::: {.columns}
::: {.column style="width: 50%; font-size: 0.85em;"}
[Adding `bill_depth_mm` as a predictor improve the prediction of `flipper_length_mm`?]{.brand-triad-blue-red .bold-black style="font-size: 1.1em;"}

To test this, we will use **Nested Linear Models**.

To ensure [practical significance]{style="text-decoration: underline;"}, we will analyze the delta of the adjusted $\text{R}^2$ of the models considering a 95% confidence interval.

We will use Cohen's benchmark for a small effect size as our Minimum Effect Size (MES) [@cohen1988a].
:::
::: {.column style="width: 50%; padding-top: 125px;"}
$$
\begin{cases}
\text{H}_{0}: \Delta \text{Adjusted} \ \text{R}^{2} = 0 \\
\text{H}_{a}: \Delta \text{Adjusted} \ \text{R}^{2} > 0
\end{cases}
$$

$$
\begin{cases}
\text{H}_{0}: \Delta \text{Adjusted} \ \text{R}^{2} < \text{MES} \\
\text{H}_{a}: \Delta \text{Adjusted} \ \text{R}^{2} \geq \text{MES}
\end{cases}
$$
:::
::::

::: {.notes}
:::

## Linear Reg.: Power Analysis {.smaller}

```{r}
library(pwrss)
library(tidyr)
```

```{r}
penguins |>
  drop_na(flipper_length_mm, bill_length_mm, bill_depth_mm) |>
  nrow()
```

```{r}
pwrss.f.reg(
  r2 = 0.02, # Cohen's f^2 for small effect sizes
  k = 2,
  power = 0.8,
  alpha = 0.05
)
```

::: {.notes}
:::

## Linear Reg.: Power Analysis {.smaller}

```{r}
library(pwrss)
library(tidyr)
```

```{r}
penguins |>
  drop_na(flipper_length_mm, bill_length_mm, bill_depth_mm) |>
  nrow()
```

```{r}
pwrss.f.reg(
  r2 = 0.15, # Cohen's f^2 for medium effect sizes
  k = 2,
  power = 0.8,
  alpha = 0.05
)
```

::: {.notes}
:::

## Linear Reg.: Scatter Plot 1 {.smaller .nostretch}

```{r}
#| fig-align: center
#| code-fold: true

library(brandr)
library(ggplot2)
library(palmerpenguins)

penguins |>
  drop_na(bill_length_mm, flipper_length_mm, species) |>
  ggplot(
    aes(
      x = bill_length_mm,
      y = flipper_length_mm,
      color = species,
      shape = species
    )
  ) +
  geom_smooth(
    inherit.aes = FALSE,
    mapping = aes(x = bill_length_mm, y = flipper_length_mm),
    method = "lm",
    formula = y ~ x,
    se = FALSE,
    color = get_brand_color("black")
  ) +
  geom_point(size = 2) +
  geom_smooth(method = "lm", formula = y ~ x, se = FALSE) +
  labs(
    x = "Bill Length (mm)",
    y = "Flipper Length (mm)",
    color = "Species",
    shape = "Species"
  ) +
  scale_color_brand_d(alpha = 0.7)
```

::: {.notes}
:::

## Linear Reg.: Scatter Plot 2 {.smaller .nostretch}

```{r}
#| fig-align: center
#| code-fold: true

library(brandr)
library(ggplot2)
library(palmerpenguins)
library(tidyr)

penguins |>
  drop_na(bill_depth_mm, flipper_length_mm, species) |>
  ggplot(
    aes(
      x = bill_depth_mm,
      y = flipper_length_mm,
      color = species,
      shape = species
    )
  ) +
  geom_point(size = 2) +
  geom_smooth(method = "lm", formula = y ~ x, se = FALSE) +
  geom_smooth(
    inherit.aes = FALSE,
    mapping = aes(x = bill_depth_mm, y = flipper_length_mm),
    method = "lm",
    formula = y ~ x,
    se = FALSE,
    color = get_brand_color("black")
  ) +
  labs(
    x = "Bill Depth (mm)",
    y = "Flipper Length (mm)",
    color = "Species",
    shape = "Species"
  ) +
  scale_color_brand_d(alpha = 0.7)
```

::: {.notes}
:::

## Linear Reg.: Prediction {.smaller .nostretch}

```{r}
#| code-fold: true
#| fig-align: center

library(brandr)
library(broom)
library(ggplot2)
library(palmerpenguins)
# library(rutils) # github.com/danielvartan/rutils
library(tidyr)

data <- penguins |> drop_na(flipper_length_mm, bill_length_mm, bill_depth_mm)

fit <-
  formula(flipper_length_mm ~ bill_length_mm + bill_depth_mm) |>
  lm(data)

fit |>
  augment(data) |>
  ggplot(aes(x = bill_length_mm, y = flipper_length_mm)) +
  geom_point() +
  geom_line(
    aes(y = .fitted, color = "Prediction"),
    linewidth = 0.5,
    alpha = 0.5,
  ) +
  geom_function(
    aes(color = "Adjusted prediction"),
    fun = rutils:::lm_fun(fit, fix_all_but = 1, data = data),
    linewidth = 1
  ) +
  labs(
    x = "Bill depth (mm)",
    y = "Flipper length (mm)",
    subtitle = rutils:::lm_str_fun(fit, fix_all_but = 1),
    color = NULL
  ) +
  ggplot2::scale_color_manual(
    values = c(
      "Prediction" = get_brand_color("square-blue-green"),
      "Adjusted prediction" = get_brand_color("triad-blue-red")
    )
  )
```

## Linear Reg.: Plane {.smaller .nostretch}

```{r}
#| eval: false
#| include: false

# Source: https://stackoverflow.com/a/70979149/8258804

# To find the `theta` and `phi` angles, do the following:
#
# * Install the `orientlib` package before doing this.
#
# 1. Run the chunk below to get a viewport open.
# 2. Adjust the size of the viewport to the size of the Quarto chart rendering.
# 3. Run `user_matrix <- rgl::par3d()$userMatrix` to get the user matrix.
# 4. Run `zoom <- rgl::par3d()$zoom` to get the zoom.
# 5. Add `user_matrix` and `zoom` to the `rgl::view3d()` function.

# install.packages("orientlib")
# user_matrix <- rgl::par3d()$userMatrix
# zoom <- rgl::par3d()$zoom
```

```{r}
#| code-fold: true
#| fig-align: center

library(dplyr)
library(palmerpenguins)
library(predict3d)
library(rgl)
library(tidyr)

user_matrix <-
  dplyr::tribble(
    ~a,         ~b,         ~c,          ~d,
    0.6233152,  -0.7817951, -0.01657271, 0,
    0.1739255,  0.1179437,  0.97767037,  0,
    -0.7623830, -0.6122792, 0.20949011,  0,
    0,          0,          0,           1
  ) |>
  as.matrix() |>
  `colnames<-`(NULL)

data <- penguins |> drop_na(flipper_length_mm, bill_length_mm, bill_depth_mm)

formula(flipper_length_mm ~ bill_length_mm + bill_depth_mm) |>
  lm(data) |>
  predict3d(
    xlab = "Bill length (mm)",
    ylab = "Bill depth (mm)",
    zlab = "Flipper length (mm)",
    radius = 0.75,
    type = "s",
    color = "red",
    show.subtitle = FALSE,
    show.error = FALSE
  )

view3d(userMatrix = user_matrix, zoom = 0.9)

rglwidget(elementId = "1st") |>
  suppressMessages() |>
  suppressWarnings()
```

::: {.notes}
In a multiple linear regression with two predictors, the model is fit by adjusting a **plane** to the data points (**Use the mouse to explore**).
:::

## Linear Reg.: Fit (Restricted) {.smaller}

:::: {.columns}
::: {.column style="width: 50%;"}
```{r}
library(broom)
library(janitor)
library(palmerpenguins)
library(parsnip)
```

```{r}
model <-
  linear_reg() |>
  set_engine("lm")
```

```{r}
fit_restricted <-
  model |>
  fit(flipper_length_mm ~ bill_length_mm, data = penguins)
```

```{r}
fit_restricted |> tidy() |> adorn_rounding(5)
```
:::
::: {.column style="width: 50%;"}
```{r}
fit_restricted_stats <- fit_restricted |> glance()
```

```{r}
fit_restricted_stats |>
  tidyr::pivot_longer(cols = dplyr::everything()) |>
  adorn_rounding(5)
```
:::
::::

::: {.notes}
:::

## Linear Reg.: Fit (Full) {.smaller}

:::: {.columns}
::: {.column style="width: 50%;"}
```{r}
library(broom)
library(palmerpenguins)
library(parsnip)
```

```{r}
model <-
  linear_reg() |>
  set_engine("lm")
```

```{r}
fit_full <-
  model |>
  fit(flipper_length_mm ~ bill_length_mm + bill_depth_mm, data = penguins)
```

```{r}
fit_full |> tidy() |> adorn_rounding(5)
```
:::
::: {.column style="width: 50%;"}
```{r}
fit_full_stats <- fit_full |> glance()
```

```{r}
fit_full_stats |>
  tidyr::pivot_longer(cols = dplyr::everything()) |>
  adorn_rounding(5)
```
:::
::::

::: {.notes}
:::

## Linear Reg.: ANOVA {.smaller}

```{r}
library(broom)
library(janitor)
```

```r
anova(fit_restricted$fit, fit_full$fit) |>
  tidy() |>
  adorn_rounding(5)
```

```{r}
#| echo: false

anova(fit_restricted$fit, fit_full$fit) |>
  broom::tidy() |>
  adorn_rounding(5) |>
  rmarkdown::paged_table()
```

::: {.notes}
:::

## Linear Reg.: Effect Size {.smaller}

```{r}
library(effectsize)
library(psychometric)
```

```{r}
fit_restricted_stats$adj.r.squared
```

```{r}
fit_restricted_stats$adj.r.squared |> interpret_r2(rules = "cohen1988")
```

```{r}
fit_full_stats$adj.r.squared
```

```{r}
fit_full_stats$adj.r.squared |> interpret_r2(rules = "cohen1988")
```

```{r}
delta <- fit_full_stats$adj.r.squared - fit_restricted_stats$adj.r.squared

delta
```

::: {.notes}
:::

## Linear Reg.: Effect Size {.smaller}

```{r}
CI.Rsq(
  rsq = delta,
  n = penguins |> nrow(),
  k = 2
)
```

```{r}
delta |> interpret_r2(rules = "cohen1988")
```

::: {.notes}
:::

## Linear Reg.: Power Analysis {.smaller}

```{r}
library(pwrss)
library(tidyr)
```

```{r}
pwrss.f.reg(
  r2 = fit_full_stats$adj.r.squared,
  k = 2,
  n =
    penguins |>
    drop_na(flipper_length_mm, bill_length_mm, bill_depth_mm) |>
    nrow(),
  power = NULL,
  alpha = 0.05
)
```

::: {.notes}
:::

## Linear Reg.: Conclusion {.smaller}

:::: {.columns}
::: {.column style="width: 60%; font-size: 0.8em;"}
[Adding `bill_depth_mm` as a predictor meaningful improve the prediction of `flipper_length_mm`?]{.brand-triad-blue-red .bold-black style="font-size: 1.1em;"}

Our analysis indicates that adding `bill_depth_mm` as a predictor improves the model adjusted $\text{R}^{2}$ in 0.19483 (95% CI \[0.12069, 0.26897\]) ($\text{F}$(2, 339) = 284, $p$-value < 0.001), exceeding the Minimal Effect Size (MES) threshold.

The power (1 - $\beta$) of the test is ~1, indicating that the probability of a false negative is very low.

Based on these results, we conclude that **`bill_depth_mm` meaningful improve the prediction of `flipper_length_mm`**. Consequently, we reject the null hypothesis in favor of the alternative hypothesis.
:::
::: {.column style="width: 40%; padding-top: 130px;"}
$$
\begin{cases}
\text{H}_{0}: \Delta \text{Adjusted} \ \text{R}^{2} = 0 \\
\text{H}_{a}: \Delta \text{Adjusted} \ \text{R}^{2} > 0
\end{cases}
$$

$$
\begin{cases}
\text{H}_{0}: \Delta \text{Adjusted} \ \text{R}^{2} < \text{MES} \\
\text{H}_{a}: \Delta \text{Adjusted} \ \text{R}^{2} \geq \text{MES}
\end{cases}
$$
:::
::::

::: {.notes}
:::
